<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhatsApp Sender - Ricardo França</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container-fluid">
    <div class="main-container">
      <div class="title-section">
        <h1><i class="bi bi-whatsapp"></i> WhatsApp Sender</h1>
        <p>Plataforma profissional para envio de mensagens em massa</p>
      </div>

      <!-- 3.1 Configuração da API -->
      <div class="section-card">
        <h3>
          <i class="bi bi-gear"></i> Configuração da API 
          <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
             title="Escolha uma API pré-configurada ou configure manualmente suas credenciais"></i>
        </h3>
        <div class="row mb-3">
          <div class="col-md-12">
            <label class="form-label">Tipo de API 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Selecione Meta, Evolution, Twilio ou informe manualmente"></i>
            </label>
            <select class="form-select" id="tipoApi" onchange="alterarTipoApi()">
              <option value="">Selecione...</option>
              <option value="meta">Meta (Facebook)</option>
              <option value="evolution">Evolution API</option>
              <option value="twilio">Twilio API</option>
              <option value="personalizada">API Personalizada</option>
            </select>
          </div>
        </div>
        <div class="row" id="camposApi" style="display: none;">
          <div class="col-md-4">
            <label class="form-label">Endpoint 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Endereço da API (gerado automaticamente)"></i>
            </label>
            <input type="url" class="form-control" id="apiEndpoint" readonly>
          </div>
          <div class="col-md-4">
            <label class="form-label">Token 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Token de acesso da API (Auth Token)"></i>
            </label>
            <input type="password" class="form-control" id="apiToken" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">ID / Account SID 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Meta: Phone ID | Twilio: Account SID"></i>
            </label>
            <input type="text" class="form-control" id="phoneId" required>
          </div>
        </div>
        <div class="row mt-2" id="campoFromNumber" style="display:none;">
          <div class="col-md-6">
            <label class="form-label">Número Remetente (From) 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Número habilitado na API para envio de mensagens"></i>
            </label>
            <input type="text" class="form-control" id="fromNumber" placeholder="+5511999999999">
          </div>
        </div>
        <button class="btn btn-primary mt-3" onclick="configurarAPI()" id="btnConfigurar" disabled>
          <i class="bi bi-check-circle"></i> Configurar API
        </button>
      </div>

      <!-- 3.2 Gerenciamento de Contatos -->
      <div class="section-card">
        <h3>
          <i class="bi bi-people"></i> Gerenciamento de Contatos 
          <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
             title="Insira telefones no formato E.164, ex.: 5511988778877,João,amigo"></i>
        </h3>
        <textarea class="form-control" id="contactsList" rows="6"
          placeholder="5511988778877,João,amigo"></textarea>
        <button class="btn btn-primary mt-3" onclick="salvarContatos()">
          <i class="bi bi-save"></i> Salvar Contatos
        </button>
      </div>

      <!-- 3.3 Composição da Mensagem -->
      <div class="section-card">
        <h3>
          <i class="bi bi-chat-text"></i> Composição da Mensagem 
          <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
             title="Use {nome} e {outro} que serão substituídos automaticamente"></i>
        </h3>
        <textarea class="form-control" id="messageText" rows="4"
          placeholder="Olá {nome}, como vai você meu {outro}?"></textarea>
        <button class="btn btn-primary mt-3" onclick="salvarMensagem()">
          <i class="bi bi-save"></i> Salvar Mensagem
        </button>
      </div>

      <!-- 3.4 Controle de Envio -->
      <div class="section-card">
        <h3><i class="bi bi-send"></i> Controle de Envio</h3>
        <div class="row">
          <div class="col-md-3">
            <label class="form-label">Intervalo Mínimo (s)
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Tempo mínimo entre envios (>=5s)"></i>
            </label>
            <input type="number" class="form-control" id="minInterval" value="5" min="5" max="60">
          </div>
          <div class="col-md-3">
            <label class="form-label">Intervalo Máximo (s)
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Tempo máximo entre envios (até 60s)"></i>
            </label>
            <input type="number" class="form-control" id="maxInterval" value="10" min="5" max="60">
          </div>
          <div class="col-md-6">
            <label class="form-label">Telefone de Teste 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Número que receberá mensagem de teste antes do envio em massa"></i>
            </label>
            <input type="text" class="form-control" id="testPhone" placeholder="5511988778877">
          </div>
        </div>
        <div class="mt-3">
          <button class="btn btn-warning me-2" onclick="sendTestMessage()">
            <i class="bi bi-lightning"></i> Enviar Teste
          </button>
          <button class="btn btn-success me-2" onclick="startSending()" id="startBtn">
            <i class="bi bi-play"></i> Iniciar Envio
          </button>
          <button class="btn btn-primary me-2" onclick="pauseSending()" id="pauseBtn" disabled>
            <i class="bi bi-pause"></i> Pausar
          </button>
          <button class="btn btn-danger" onclick="stopSending()" id="stopBtn" disabled>
            <i class="bi bi-stop"></i> Cancelar
          </button>
        </div>
      </div>

      <!-- 3.5 Feedback e Monitoramento -->
      <div class="row g-4">
        <div class="col-12 col-lg-4">
          <div class="section-card h-100">
            <h3><i class="bi bi-graph-up"></i> Performance</h3>
            <div class="performance-card">
              <h5>Esta Semana</h5>
              <div class="performance-number" id="weekSent">0</div>
              <small>Enviadas | <span id="weekFailed">0</span> Falhas</small>
            </div>
            <div class="performance-card">
              <h5>Este Semestre</h5>
              <div class="performance-number" id="semesterSent">0</div>
              <small>Enviadas | <span id="semesterFailed">0</span> Falhas</small>
            </div>
            <div class="performance-card">
              <h5>Este Ano</h5>
              <div class="performance-number" id="yearSent">0</div>
              <small>Enviadas | <span id="yearFailed">0</span> Falhas</small>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-8">
          <div class="section-card h-100">
            <h3><i class="bi bi-list-ul"></i> Logs de Envio 
              <i class="bi bi-question-circle tooltip-icon" data-bs-toggle="tooltip" 
                 title="Acompanhe em tempo real o status de cada envio"></i>
            </h3>
            <div class="log-area" id="logArea">
              <div class="log-entry log-info">
                <strong>[Sistema]</strong> Aguardando início dos envios...
              </div>
            </div>
            <button class="btn btn-secondary mt-2" onclick="clearLogs()">
              <i class="bi bi-trash"></i> Limpar Logs
            </button>
          </div>
        </div>
      </div>

      <!-- Gráfico -->
      <div class="section-card mt-4">
        <h3><i class="bi bi-graph-up-arrow"></i> Gráficos em Tempo Real</h3>
        <canvas id="chartEnvios" height="120"></canvas>
      </div>

      <!-- 3.6 Assinatura -->
      <div class="author-signature mt-4">
        <h4><i class="bi bi-person-badge"></i> Ricardo França</h4>
        <p>Empresário, Investidor e Mentor</p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</body>
</html>
